import{z as B,A as n,o as r,x as u,w as i,d as v,t as d,m as c,ao as m,p as b,q as w}from"./multiselect-82d1182f.js";import{f as D,a as _,F as N,t as A}from"./index-5e60d8d5.js";import{_ as V}from"./Modal.vue_vue_type_script_setup_true_lang-d1f72c5a.js";import{_ as j}from"./ImportModalFirstStep.vue_vue_type_script_setup_true_lang-c82d2fa9.js";import{_ as q}from"./ImportModalThirdStep.vue_vue_type_script_setup_true_lang-6359bf33.js";import{_ as x}from"./ImportModalSecondStep.vue_vue_type_script_setup_true_lang-e2f1bbb2.js";const Q=B({__name:"ImportModal",props:{locales:{},open:{type:Boolean}},emits:["toggleOpen"],setup(z,{emit:$}){const o=n(!1),t=n(1),F=n(null),h=n(null),p=n(""),g=n(null),y=n(null),O=n(null),k=n(0),l=n([]),T=n(!1),I=a=>{h.value=a,F.value=a},M=a=>{p.value=a},S=a=>{T.value=a},C=D(),L=$,U=()=>{L("toggleOpen")},P=()=>{if(o.value=!0,t.value===1){let a=route("mycustomadmin.translations.import"),s=new FormData;s.append("fileImport",h.value??""),s.append("importLanguage",p.value),s.append("onlyMissing",T.value?"1":"0"),w.post(a,s,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{if(e.data.hasOwnProperty("numberOfImportedTranslations")&&e.data.hasOwnProperty("numberOfUpdatedTranslations"))t.value=3,g.value=e.data.numberOfImportedTranslations,y.value=e.data.numberOfUpdatedTranslations;else{t.value=2,O.value=Object.keys(e.data).length,l.value=e.data;for(let f=0;f<l.value.length;f++)l.value[f].hasOwnProperty("has_conflict")&&l.value[f].has_conflict&&k.value++}},e=>{C.error(e.response.data)}).finally(()=>{o.value=!1})}else if(t.value===2){for(let e=0;e<l.value.length;e++)l.value[e].hasOwnProperty("checkedCurrent")&&l.value[e].checkedCurrent&&(l.value[e][p.value.toLowerCase()]=l.value[e].current_value);let a="/admin/translations/import/conflicts",s={importLanguage:p.value,resolvedTranslations:l.value};w.post(a,s).then(e=>{t.value=3,g.value=e.data.numberOfImportedTranslations,y.value=e.data.numberOfUpdatedTranslations},e=>{C.error(A("An error has occurred."))}).finally(()=>{o.value=!1})}};return(a,s)=>(r(),u(m(V),{open:a.open,onToggleOpen:U,"external-open":!0},{title:i(()=>[v(d(a.$t("Import translations")),1)]),content:i(()=>[t.value===1?(r(),u(j,{key:0,locales:a.locales,processing:o.value,onUploadFile:I,onSelectLanguage:M,onCheckOnlyMissing:S},null,8,["locales","processing"])):c("",!0),t.value===2?(r(),u(x,{key:1,"import-language":p.value,locales:a.locales,"number-of-found-translations":O.value,"number-of-translations-to-review":k.value,processing:o.value,"translations-to-import":l.value},null,8,["import-language","locales","number-of-found-translations","number-of-translations-to-review","processing","translations-to-import"])):c("",!0),t.value===3?(r(),u(q,{key:2,locales:a.locales,"number-of-successfully-imported-translations":g.value,"number-of-successfully-updated-translations":y.value,processing:o.value},null,8,["locales","number-of-successfully-imported-translations","number-of-successfully-updated-translations","processing"])):c("",!0)]),buttons:i(({setIsOpen:e})=>[t.value!==3?(r(),u(m(_),{key:0,disabled:o.value,onClick:b(P,["prevent"])},{default:i(()=>[v(d(a.$t("Next step")),1)]),_:1},8,["disabled"])):c("",!0),t.value!==3?(r(),u(m(_),{key:1,variant:"outline",color:"gray",onClick:b(()=>{e()},["prevent"])},{default:i(()=>[v(d(a.$t("Cancel")),1)]),_:2},1032,["onClick"])):c("",!0),t.value===3?(r(),u(m(_),{key:2,onClick:b(()=>{e(),m(N).reload(),t.value=1},["prevent"])},{default:i(()=>[v(d(a.$t("Finish import")),1)]),_:2},1032,["onClick"])):c("",!0)]),_:1},8,["open"]))}});export{Q as _};
